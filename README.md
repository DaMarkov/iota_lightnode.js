# IOTA Lightnode: a wrapper for the IOTA Javascript Library

`iota_lightnode.js` wraps the IOTA Javascript Library `iota.lib.js` and overs the following high-level features

* Generate transaction list of bundles
* Discovery of confirmed/rejected/pending bundles
* Reconnect to next node after timeout
* Proxy server with caching for faster syncing
* Sign transactions offline (cold storage)
* Supports ccurl and curl.js to do the proof of work locally
* Detects if the node can perform the proof of work
* Promotes transactions, detects if the sub-tangle is inconsistent and reattaches the bundle automatically if necessary
* Supports pre-bundles for easier construction of complicated bundles


## Installation

```
git clone https://github.com/DaMarkov/iota_lightnode.js.git
cd iota_lightnode.js
npm install
```


## Getting Started


```js
<script type="text/javascript" src="dist/iota_lightnode.browser.js"></script>
<script type="text/javascript" src="deb/curl.min.js"></script>

<script>

var lightnode = window.iota_lightnode.initializeIOTA();//initialize iota lightnode
lightnode.setCurlLibrary(window.curl);//Connect lightnode with curl to do the proof of work in the browser

var seed = lightnode.generateSeedInsecurely();//Generate seed (Seeds generated by this function are NOT cryptographic safe!)

lightnode.calculateFirstAddress(seed, function(error, new_address)//Generate the first address of this seed
{
	//Attach address to tangle
    var transfer = [{//Transfer to be attached to the tangle
        'address': new_address,//Recipient address (our own)
        'value': parseInt(0),//Number of IOTA to be transacted
    }];

    lightnode.sendTransfer(seed, transfer, function(error, attached_bundle)//Prepare bundle, do tip selection, perform proof of work and attach to tangle
    {
        if (error)//Either invalid transfer or node is down
        {
            console.error(error);
            console.log( "Error! Could not submit transaction! The node you are connecting to might be down." );
        }
        else//Success
        {
            console.log( "Successfully attached your transaction to the tangle with bundle", attached_bundle);
            console.log( "The transaction hash is: ", attached_bundle[0].hash );
        }
    });
});

</script>
```
The folder examples/ contains additional examples.

## Structure

`bin/` contains the compiled version of ccurl for Windows/Mac/Linux 64-bit.
`deb/` contains dependencies used in examples. Most noticeable `curl.min.js` which is used to perform the proof of work in browser.
`dist/` iota_lightnode browser and `node.js` version as well as `mnemonic.js` to convert seeds in a readable format
`examples/` example files
`proxy-server/` proxy server using `node.js`. This server connects to a node and acts as a cache.
`src/` additional source code of `iota_lightnode.js`



---

## Reference

- **[calculateAddress](#calculateaddress)**
- **[calculateFirstAddress](#calculatefirstaddress)**
- **[checkConfirmations](#checkconfirmations)**
- **[createPreBundle](#createprebundle)**
- **[enableLocalProofOfWork](#enablelocalproofofwork)**
- **[ensureBundleGetsConfirmed](#ensurebundlegetsconfirmed)**
- **[findBundle](#findbundle)**
- **[fromTrytes](#fromtrytes)**
- **[generateSeedInsecurely](#generateseedinsecurely)**
- **[getBalance](#getbalance)**
- **[getConfirmedBalance](#getconfirmedbalance)**
- **[getTransactions](#gettransactions)**
- **[getAddresses](#getaddresses)**
- **[getBundles](#getbundles)**
- **[getBundlesOfAddress](#getbundlesofaddress)**
- **[getBundlesOfAddressIndex](#getbundlesofaddressindex)**
- **[getTransactionsOfAddress](#gettransactionsofaddress)**
- **[getTransactionsOfAddressIndex](#gettransactionsofaddressindex)**
- **[getAccountData](#getaccountdata)**
- **[initializeIOTA](#initializeiota)**
- **[isCheckingConfirmations](#ischeckingconfirmations)**
- **[isRemoteProofOfWorkAvailable](#isremoteproofofworkavailable)**
- **[isSyncing](#issyncing)**
- **[isProofOfWorkLocal](#isproofofworklocal)**
- **[isPerformingTransfers](#isperformingtransfers)**
- **[isPerformingProofOfWork](#isperformingproofofwork)**
- **[isInputAddress](#isinputaddress)**
- **[isOutputAddress](#isoutputaddress)**
- **[isInAddressList](#isinaddresslist)**
- **[getIOTA](#getiota)**
- **[getProvider](#getprovider)**
- **[setProvider](#setprovider)**
- **[reattachBundle](#reattachbundle)**
- **[reattachTransaction](#reattachtransaction)**
- **[sendTransfer](#sendtransfer)**
- **[setCurlLibrary](#setcurllibrary)**
- **[signPreBundle](#signprebundle)**
- **[sendPreBundle](#sendprebundle)**
- **[sendSignedBundle](#sendsignedbundle)**
- **[toTrytes](#totrytes)**
- **[updateAddress](#updateaddress)**
- **[updateAddressesOneByOne](#updateaddressesonebyone)**

---



### `calculateAddress`

Initializes iota_lightnode.js and iota.lib.js. This function has to be called before any other function of iota_lightnode.js can be called.

#### Input
```js
window.iota_lightnode.calculateAddress(seed, index, total, checksum, security, callback(error, addresses))
```

1. **`seed`**: `81-trytes` seed used to generate the address.
2. **`index`**: `integer` index of the (first) address to be generated. Set to 0 to obtain the first address of the seed, 1 to obtain the second, etc. Default: 0.
3. **`total`**: `integer` number of addresses to be generated. Default: 1.
4. **`checksum`**: `bool` Set to `true` to generate address with a checksum (90 `trytes` long). If set to `false`, addresses generated will lack a checksum. Default: `false`.
5. **`security`**: `integer` security parameter that is used for the addresses. Default: The default was set when `initializeIOTA()` was called.
5. **`callback`**: `function` This function will be called `total` number of times. The first parameter contains any error(s), the second an array of the addresses that have (so far) been generated.

#### Return Value

None

#### Example

```js
var seed  = OFMEOSBNBTAXQTGBHLVRRPAMPYUXZAFBAIHMJQHCSVPUELJMHNCNMSTX9DWZH9INOU9OJAUTPOYOTRZKY;
var total = 10;

window.iota_lightnode.calculateAddress(seed, 0, total, true, 3, function(error, addresses) {
	console.log(addresses.length, "have been generated so far:", addresses);
});
```



### `initializeIOTA`

Initializes iota_lightnode.js and iota.lib.js. This function has to be called before any other function of iota_lightnode.js can be called.

#### Input
```js
window.iota_lightnode.initializeIOTA(security, depth, minWeightMagnitude)
```

1. **`security`**: `integer` security parameter that should be used for address generation if no additional security parameter is supplied. Default: 2.
2. **`depth`**: `integer` depth parameter for iota.lib.js. Used in the tip selection algorithm. Default: 3.
2. **`minWeightMagnitude`**: `integer` minimum weight parameter used for the proof of work. The difficult of the proof of work increases with this parameter. Currently, only transactions with weight magnitude >= 14 will be accepted by the network (of main net). Default: 14

#### Return Value

1. **`Object`** - returns the iota_lightnode object.

#### Example

```js
var lightnode = window.iota_lightnode.initializeIOTA();
```


### `getIOTA`

Returns the IOTA object of `iota.lib.js`.

#### Input

None.

#### Return Value

1. **`Object`** - returns the IOTA object of `iota.lib.js`.

#### Example

```js
window.iota_lightnode.getIOTA().getNewAddress(seed, {'index': index, 'checksum': true, 'security': 2}, function(error, new_address) {
	console.log(new_address, "generated with iota.lib.js within iota_lightnode");
});
```


---